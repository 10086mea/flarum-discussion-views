(()=>{var t={n:s=>{var e=s&&s.__esModule?()=>s.default:()=>s;return t.d(e,{a:e}),e},d:(s,e)=>{for(var o in e)t.o(e,o)&&!t.o(s,o)&&Object.defineProperty(s,o,{enumerable:!0,get:e[o]})},o:(t,s)=>Object.prototype.hasOwnProperty.call(t,s),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},s={};(()=>{"use strict";t.r(s);const e=flarum.core.compat.app;var o=t.n(e);const n=flarum.core.compat.extend,r=flarum.core.compat["states/DiscussionListState"];var i=t.n(r);const a=flarum.core.compat.Model;var u=t.n(a);const c=flarum.core.compat["models/Discussion"];var l=t.n(c);const p=flarum.core.compat["components/DiscussionListItem"];var d=t.n(p);const f=flarum.core.compat["components/DiscussionList"];var v=t.n(f);const h=flarum.core.compat["utils/abbreviateNumber"];var w=t.n(h);function b(t,s){return b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,s){return t.__proto__=s,t},b(t,s)}function y(t,s){t.prototype=Object.create(s.prototype),t.prototype.constructor=t,b(t,s)}var g=function(t){function s(){for(var s,e=arguments.length,o=new Array(e),n=0;n<e;n++)o[n]=arguments[n];return(s=t.call.apply(t,[this].concat(o))||this).visitedAt=u().attribute("visited_at",u().transformDate),s.user=u().hasOne("user"),s.discussion=u().hasOne("discussion"),s}return y(s,t),s}(u());const _=flarum.core.compat["components/Button"];var N=t.n(_);const V=flarum.core.compat["utils/DiscussionControls"];var M=t.n(V);const D=flarum.core.compat["components/Modal"];var O=function(t){function s(){return t.apply(this,arguments)||this}y(s,t);var e=s.prototype;return e.oninit=function(s){t.prototype.oninit.call(this,s),this.discussion=this.attrs.discussion,this.currentViewsCount=this.discussion.viewCount()},e.content=function(){return m("div",{className:"Modal-body"},m("div",{className:"Form Form--centered"},m("p",null,app.translator.trans("michaelbelgium-discussion-views.forum.modal_resetviews.label",{count:this.currentViewsCount})),m("div",{className:"Form-group"},N().component({className:"Button Button--primary Button--block",type:"submit",loading:this.loading},app.translator.trans("michaelbelgium-discussion-views.forum.modal_resetviews.submit_button")))))},e.title=function(){return app.translator.trans("michaelbelgium-discussion-views.forum.modal_resetviews.title")},e.className=function(){return"Modal--small"},e.onsubmit=function(t){var s=this;t.preventDefault(),this.loading=!0,this.attrs.discussion.save({resetViews:!0}).catch((function(){s.loaded()})),this.hide()},s}(t.n(D)());const P=flarum.core.compat["helpers/username"];var C=t.n(P);const L=flarum.core.compat["helpers/icon"];var x=t.n(L);const S=flarum.core.compat["helpers/punctuateSeries"];var j=t.n(S);const k=flarum.core.compat["helpers/avatar"];var F=t.n(k);const q=flarum.core.compat["utils/ItemList"];var A=t.n(q);const B=flarum.core.compat["utils/humanTime"];var I=t.n(B);const U=flarum.core.compat["components/CommentPost"];var R=t.n(U);const T=flarum.core.compat["components/Link"];var z=t.n(T);const E=flarum.core.compat["components/DiscussionPage"];var G=t.n(E);const H=flarum.core.compat["components/FieldSet"];var J=t.n(H);const K=flarum.core.compat["common/components/Modal"];var Q=function(t){function s(){return t.apply(this,arguments)||this}y(s,t);var e=s.prototype;return e.className=function(){return"Modal--small"},e.title=function(){return app.translator.trans("michaelbelgium-discussion-views.forum.post.modal_title_text")},e.content=function(){var t=this.attrs.post.discussion().uniqueViews().map((function(t){var s=t.user();return m("li",null,m(z(),{href:app.route.user(s)},F()(s)," "," ",C()(s)))}));return m("div",{className:"Modal-body"},m("ul",{className:"PostLikesModal-list"},t))},s}(t.n(K)());o().initializers.add("michaelbelgium-discussion-views",(function(){(0,n.extend)(i().prototype,"sortMap",(function(t){1==app.forum.attribute("toggleFilter")&&(t.popular="-view_count",t.unpopular="view_count")})),o().store.models.discussionviews=g,l().prototype.views=u().hasMany("latestViews"),l().prototype.uniqueViews=u().hasMany("uniqueViews"),l().prototype.canReset=u().attribute("canReset"),l().prototype.canViewNumber=u().attribute("canViewNumber"),l().prototype.viewCount=u().attribute("viewCount"),(0,n.extend)(d().prototype,"infoItems",(function(t){if(this.attrs.discussion.canViewNumber()){var s=this.attrs.discussion.viewCount(),e=1==o().forum.attribute("abbrNumber")?w()(s):s;t.add("discussion-views",m("span",null,e))}})),(0,n.extend)(v().prototype,"requestParams",(function(t){t.include.push("latestViews")})),(0,n.extend)(M(),"moderationControls",(function(t,s){s.canReset()&&s.viewCount()>0&&t.add("reset",m(N(),{icon:"far fa-eye-slash",onclick:function(){return app.modal.show(O,{discussion:s})}},app.translator.trans("michaelbelgium-discussion-views.forum.discussion_controls.resetviews_button")))})),(0,n.extend)(G().prototype,"sidebarItems",(function(t){if(0!=app.forum.attribute("showViewList")){var s=this.discussion.views(),e=new(A());$.each(s,(function(t,s){var o=!1===s.user()?app.translator.trans("michaelbelgium-discussion-views.forum.viewlist.guest"):s.user().username(),n=m("div",{className:"item-lastUser-content"},F()(s.user()),m("div",null,o,m("span",{className:"lastUser-visited",title:s.visitedAt().toLocaleString()},I()(s.visitedAt()))));!1!==s.user()&&(n=m(z(),{href:app.route.user(s.user())},n)),e.add("lastUser-"+t,n)})),t.add("lastDiscussionViewers",m(J(),{className:"LastDiscussionUsers",label:app.translator.trans("michaelbelgium-discussion-views.forum.viewlist.title")},e.toArray()))}})),(0,n.extend)(R().prototype,"footerItems",(function(t){if(0!=app.forum.attribute("showFooterViewList")){var s=this.attrs.post,e=s.discussion(),o=e.uniqueViews();if(!1!==e.posts()&&0!=e.posts().length&&e.posts()[0].id()===s.id()&&o&&o.length>0){var n=o.slice(0,5).map((function(t){return m(z(),{href:app.route.user(t.user())},t.user()===app.session.user?app.translator.trans("michaelbelgium-discussion-views.forum.post.you"):C()(t.user()))}));if(o.length>5){var r=o.length-5;n.push(m(z(),{href:"#",onclick:function(t){t.preventDefault(),app.modal.show(Q,{post:s})}},app.translator.trans("michaelbelgium-discussion-views.forum.post.others_link",{count:r})))}n.length>0&&t.add("viewed",m("div",{className:"Post-Discussion-viewedBy"},x()("fas fa-eye"),app.translator.trans("michaelbelgium-discussion-views.forum.post.viewed_by",{users:j()(n)})))}}}))}))})(),module.exports=s})();
//# sourceMappingURL=forum.js.map